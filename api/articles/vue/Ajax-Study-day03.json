{"title":"Ajax Study day03","uid":"3961be608d49dc29dafdd30815d4f1d9","slug":"vue/Ajax-Study-day03","date":"2022-12-03T10:59:16.000Z","updated":"2022-12-03T16:53:59.598Z","comments":true,"path":"api/articles/vue/Ajax-Study-day03.json","keywords":null,"cover":"/img/VUE.jpeg","content":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p>这个地方的技术实在是太乱了, 根本不好搞, 真的很烦. </p>\n<h1 id=\"Ajax\"><a href=\"#Ajax\" class=\"headerlink\" title=\"Ajax\"></a>Ajax</h1><h2 id=\"通过json返回请求\"><a href=\"#通过json返回请求\" class=\"headerlink\" title=\"通过json返回请求\"></a>通过json返回请求</h2><p><strong>JSON 是 JS 对象的字符串表示法，它使用文本表示一个 JS 对象的信息，本质是一个字符串。</strong></p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">const jsonStuff &#x3D; &#123;\n    count: x,\n    data: &quot;data&quot;,\n&#125;\nresponse.send(jsonStuff)</code></pre>\n\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">const jsonStuff &#x3D; JSON.parse(xhr.response)\n$(&#39;#result&#39;).html(jsonStuff.count+&quot;&lt;br&gt;&quot;+jsonStuff.data);</code></pre>\n\n<p>上面的<code>JSON</code>把本来的字符串转化为JSON格式, 然后通过<code>.</code>来通过key获取相应的值</p>\n<p>也可以提前设置xhr的接受属性</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">xhr.responseType &#x3D; &#39;json&#39;</code></pre>\n\n<p>这样一劳永逸</p>\n<h2 id=\"延时-超时-断网-相关操作\"><a href=\"#延时-超时-断网-相关操作\" class=\"headerlink\" title=\"延时, 超时, 断网, 相关操作\"></a>延时, 超时, 断网, 相关操作</h2><ol>\n<li><p>延时</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">setTimeout(function ()&#123;\n    response.send(&quot;两秒钟过去了&quot;)\n&#125;, 2000)</code></pre>\n</li>\n<li><p>设置超过一秒算超时</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">xhr.timeout &#x3D; 1000;\nxhr.ontimeout &#x3D; function ()&#123;\n    $(&#39;#result&#39;).text(&quot;已经过了亿秒钟了&quot;)\n&#125;</code></pre>\n</li>\n<li><p>断网</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">xhr.onerror &#x3D; function ()&#123;\n    $(&#39;#result&#39;).text(&quot;断网怎么说, 断网&quot;)\n&#125;</code></pre>\n</li>\n<li><p>终止</p>\n<p><code>xhr.abort()</code></p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F;这里把shr的声明放到了外面, 是为了提高他的作用域, 这样我们才能终止\nlet xhr &#x3D; null;\n$(&#39;#abort&#39;).click(function ()&#123;\n    xhr.abort();\n    $(&#39;#result&#39;).text(&quot;断网怎么说, 断网&quot;)\n&#125;)</code></pre></li>\n</ol>\n<h2 id=\"重复发送请求问题\"><a href=\"#重复发送请求问题\" class=\"headerlink\" title=\"重复发送请求问题\"></a>重复发送请求问题</h2><p>万一有人犯癫痫, 一致发送重复请求, 这样服务器压力很大, 因为请求是需要时间的, 所以我们可以判断, 在请求时间内, 如果重复请求, 则忽略, 或者也可以忽略之前的请求, 重新发送请求, 总之保持一个请求. </p>\n<p>首先把flag定义在click方法外面</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">let flag &#x3D; false\n$(&#39;#getMessage&#39;).click(function ()&#123;</code></pre>\n\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">if (!flag)&#123;\n    flag &#x3D; true\n    xhr &#x3D; new XMLHttpRequest();\n\n    xhr.onerror &#x3D; function ()&#123;\n        $(&#39;#result&#39;).text(&quot;断网怎么说, 断网&quot;)\n    &#125;\n    &#x2F;&#x2F;2:初始化, 设置请求方法和请求url\n    xhr.open(&#39;GET&#39;, &#39;http:&#x2F;&#x2F;localhost:8000&#x2F;delay&#39;)\n    &#x2F;&#x2F;3: 发送\n    xhr.send();\n\n    xhr.onreadystatechange &#x3D; function ()&#123;\n        if(xhr.readyState &#x3D;&#x3D;&#x3D; 4)&#123;\n\n\n            if (xhr.status &gt;&#x3D; 200 &amp;&amp; xhr.status &lt; 300)&#123;\n                const time2 &#x3D; Date.now();\n\n                $(&#39;#result&#39;).text(xhr.response).append(time2 - time)\n            &#125;\n            flag &#x3D; false\n        &#125;\n    &#125;\n&#125;else &#123;\n    return\n&#125;</code></pre>\n\n<p>也可以重新发送</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">if (flag)&#123;\n    xhr.abort();\n&#125;</code></pre>\n\n<h1 id=\"Ajax与jQuery\"><a href=\"#Ajax与jQuery\" class=\"headerlink\" title=\"Ajax与jQuery\"></a>Ajax与jQuery</h1><h2 id=\"发送get与post请求\"><a href=\"#发送get与post请求\" class=\"headerlink\" title=\"发送get与post请求\"></a>发送get与post请求</h2><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">$(&#39;#getMessage&#39;).click(function ()&#123;\n\n    &#x2F;&#x2F;参数: url json数据 回调函数(返回的数据)\n    $.get(&quot;http:&#x2F;&#x2F;localhost:8000&#x2F;jQuery&quot;, &#123;a:123, b:456&#125;, function (data)&#123;\n        $(&#39;#result&#39;).text(&quot;获取成功&quot;+data)\n    &#125;)\n&#125;)\n\n$(&#39;#getMessage2&#39;).click(function ()&#123;\n\n    &#x2F;&#x2F;参数: url json数据 回调函数(返回的数据)\n    $.post(&quot;http:&#x2F;&#x2F;localhost:8000&#x2F;jQuery&quot;, &#123;a:123, b:456&#125;, function (data)&#123;\n        $(&#39;#result&#39;).text(&quot;获取成功&quot;+data)\n    &#125;)\n&#125;)</code></pre>\n\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">app.all(&quot;&#x2F;jQuery&quot;, function (request, response)&#123;\n    response.setHeader(&#39;Access-Control-Allow-Origin&#39;, &quot;*&quot;)\n\n    setTimeout(function ()&#123;\n        response.send(&quot;123&quot;)\n    &#125;, 2000)\n\n&#125;)</code></pre>\n\n<h2 id=\"接受回传信息\"><a href=\"#接受回传信息\" class=\"headerlink\" title=\"接受回传信息\"></a>接受回传信息</h2><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">const data &#x3D; &#123;\n    car : &#39;fute&#39;,\n    money : &#39;800000000&#39;,\n\n&#125;\nsetTimeout(function ()&#123;\n    response.send(data)\n&#125;, 2000)</code></pre>\n\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">$(&#39;#getMessage2&#39;).click(function ()&#123;\n\n    &#x2F;&#x2F;参数: url json数据 回调函数(返回的数据)\n    $.post(&quot;http:&#x2F;&#x2F;localhost:8000&#x2F;jQuery&quot;, &#123;a:123, b:456&#125;, function (data)&#123;\n        $(&#39;#result&#39;).text(&quot;获取成功&quot;+data.car)\n        console.log(data)\n    &#125;)\n&#125;)</code></pre>\n\n<p>如果想自定义强的话, 可以使用jq的ajax请求, 几乎所有参数都可以更改调整, 具体可查jq的文档</p>\n<h1 id=\"Axios\"><a href=\"#Axios\" class=\"headerlink\" title=\"Axios\"></a>Axios</h1><p>当今最热门的操纵Ajax的东西, 我们可以在<a href=\"https://www.bootcdn.cn/\">BootCDN</a>下载镜像</p>\n<p>直接复制标签, 插进去就能用</p>\n<h3 id=\"get与post\"><a href=\"#get与post\" class=\"headerlink\" title=\"get与post\"></a>get与post</h3><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">axios.defaults.baseURL &#x3D; &quot;http:&#x2F;&#x2F;localhost:8000&quot;\n\n$(&#39;#getMessage&#39;).click(function ()&#123;\n\n    &#x2F;&#x2F;get 参数:\n    axios.get(&#39;&#x2F;getSomething&#39;, &#123;\n        &#x2F;&#x2F;URL参数\n        params:&#123;\n            name:&#39;张三&#39;,\n            age:&quot;12&quot;,\n        &#125;,\n        &#x2F;&#x2F;设置请求头\n        headers:&#123;\n\n        &#125;,\n\n    &#125;).then(value &#x3D;&gt; &#123;\n        &#x2F;&#x2F;回调函数\n        console.log(value)\n    &#125;)\n\n&#125;)</code></pre>\n\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F;post的第二个参数是json的请求体, 第三个才是自定义\n$(&#39;#getMessage2&#39;).click(function ()&#123;\n    axios.post(&#39;&#x2F;postSomething&#39;, &#123;\n        firstName: &#39;Fred&#39;,\n        lastName: &#39;Flintstone&#39;\n    &#125;, &#123;\n        params: &#123;\n            \n        &#125;\n    &#125;)\n        .then(function (response) &#123;\n            console.log(response);\n        &#125;)\n&#125;)</code></pre>\n\n<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">注意</p>\n<p><p>这里注意, 使用axios进行post请求的时候, 必须在请求端设置自定义请求头, 否则会报错</p>\n<pre class=\"line-numbers language-js\\\" data-language=\"js\\\"><code class=\"language-js\\\">res.setHeader(&quot;Access-Control-Allow-Headers&quot;, &quot;*&quot;);</code></pre>\n\n</p>\n</div>\n<h1 id=\"后记\"><a href=\"#后记\" class=\"headerlink\" title=\"后记\"></a>后记</h1><p>今天感觉有点划水, 本来想一天学完的东西, 结果还是得拖到明天上午留个尾巴, 感觉我的斗志已经慢慢下来了, 开始寄希望于未来了, 相信未来的我的智慧吧.</p>\n","feature":false,"text":"前言这个地方的技术实在是太乱了, 根本不好搞, 真的很烦. Ajax通过json返回请求JSON 是 JS 对象的字符串表示法，它使用文本表示一个 JS 对象的信息，本质是一个字符串。 const jsonStuff &#x3D; &#123; count: x, data: &...","link":"","photos":[],"count_time":{"symbolsCount":"4.6k","symbolsTime":"4 mins."},"categories":[{"name":"Study","slug":"Study","count":20,"path":"api/categories/Study.json"}],"tags":[{"name":"Ajax","slug":"Ajax","count":3,"path":"api/tags/Ajax.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">前言</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#Ajax\"><span class=\"toc-text\">Ajax</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%80%9A%E8%BF%87json%E8%BF%94%E5%9B%9E%E8%AF%B7%E6%B1%82\"><span class=\"toc-text\">通过json返回请求</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%BB%B6%E6%97%B6-%E8%B6%85%E6%97%B6-%E6%96%AD%E7%BD%91-%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C\"><span class=\"toc-text\">延时, 超时, 断网, 相关操作</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%87%8D%E5%A4%8D%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82%E9%97%AE%E9%A2%98\"><span class=\"toc-text\">重复发送请求问题</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#Ajax%E4%B8%8EjQuery\"><span class=\"toc-text\">Ajax与jQuery</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%91%E9%80%81get%E4%B8%8Epost%E8%AF%B7%E6%B1%82\"><span class=\"toc-text\">发送get与post请求</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%8E%A5%E5%8F%97%E5%9B%9E%E4%BC%A0%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">接受回传信息</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#Axios\"><span class=\"toc-text\">Axios</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#get%E4%B8%8Epost\"><span class=\"toc-text\">get与post</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%90%8E%E8%AE%B0\"><span class=\"toc-text\">后记</span></a></li></ol>","author":{"name":"Someone Serious","slug":"blog-author","avatar":"/img/photo.jpg","link":"/","description":"here is someone serious <br />只是一个小学生, 学艺不精多多见谅","socials":{"github":"https://github.com/Some1Serious","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"QQ":{"icon":"/svg/QQ.svg","link":"/img/myQQ.png"},"Email":{"icon":"/svg/email-fill.svg","link":"mailto:1025698918@qq.com"}}}},"mapped":true,"prev_post":{"title":"javaScript 表单验证","uid":"5e5d631a7897b1bae550b31b22f44657","slug":"HtmlCssJs/javaScript-表单验证","date":"2022-11-17T06:36:01.000Z","updated":"2022-11-17T08:57:59.951Z","comments":true,"path":"api/articles/HtmlCssJs/javaScript-表单验证.json","keywords":null,"cover":"/img/java-script.jpg","text":"说明实现用javaScript实现对表单数据的合法性认证, 表单包括: 用户名, 密码, 邮箱 1. 创建html文件&lt;form id &#x3D; &quot;userPost&quot; method&#x3D;&quot;post&quot;&gt; &lt;labe...","link":"","photos":[],"count_time":{"symbolsCount":"3.8k","symbolsTime":"3 mins."},"categories":[{"name":"Result","slug":"Result","count":5,"path":"api/categories/Result.json"}],"tags":[{"name":"javaScript","slug":"javaScript","count":2,"path":"api/tags/javaScript.json"}],"author":{"name":"Someone Serious","slug":"blog-author","avatar":"/img/photo.jpg","link":"/","description":"here is someone serious <br />只是一个小学生, 学艺不精多多见谅","socials":{"github":"https://github.com/Some1Serious","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"QQ":{"icon":"/svg/QQ.svg","link":"/img/myQQ.png"},"Email":{"icon":"/svg/email-fill.svg","link":"mailto:1025698918@qq.com"}}}},"feature":true},"next_post":{"title":"Ajax Study day02","uid":"75dae5aac09587a263fe4e6ca350f17e","slug":"vue/Ajax-Study-day02","date":"2022-12-01T13:44:29.000Z","updated":"2022-12-03T10:58:33.087Z","comments":true,"path":"api/articles/vue/Ajax-Study-day02.json","keywords":null,"cover":"/img/VUE.jpeg","text":"前言看了几天这个CCF考试, 被折磨了, 又看了看若依, 又被折磨了, 一堆东西不会, 真TMD. jQuery添加删除修改类jQuery可以控制元素的类, 我们通过类来控制元素的样式, 所以修改样式也就通过修改类来实现了. $(&#39;.box&#39;).click(fun...","link":"","photos":[],"count_time":{"symbolsCount":"5.3k","symbolsTime":"5 mins."},"categories":[{"name":"Study","slug":"Study","count":20,"path":"api/categories/Study.json"}],"tags":[{"name":"Ajax","slug":"Ajax","count":3,"path":"api/tags/Ajax.json"},{"name":"jQuery","slug":"jQuery","count":2,"path":"api/tags/jQuery.json"},{"name":"Express","slug":"Express","count":1,"path":"api/tags/Express.json"}],"author":{"name":"Someone Serious","slug":"blog-author","avatar":"/img/photo.jpg","link":"/","description":"here is someone serious <br />只是一个小学生, 学艺不精多多见谅","socials":{"github":"https://github.com/Some1Serious","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"QQ":{"icon":"/svg/QQ.svg","link":"/img/myQQ.png"},"Email":{"icon":"/svg/email-fill.svg","link":"mailto:1025698918@qq.com"}}}},"feature":false}}